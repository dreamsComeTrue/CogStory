// Copyright 2017-2019 Dominik 'dreamsComeTrue' Jasi≈Ñski. All Rights Reserved.

//--------------------------------------------------------------------------------------------------
//  0_intro.script
//--------------------------------------------------------------------------------------------------

#include "../../Data/scripts/Common.script"

//--------------------------------------------------------------------------------------------------

void Start ()
{
    SetSuppressSceneInfo (true);
    IntroAnimation ();        
}

//--------------------------------------------------------------------------------------------------

void BeforeEnterScene ()
{   
}

//--------------------------------------------------------------------------------------------------

void AfterLeaveScene ()
{
}

//--------------------------------------------------------------------------------------------------

void IntroAnimation ()
{   
    player.SetPreventInput (true);
    player.Hide ();
    
    CitySceneAnimation ();
}

//--------------------------------------------------------------------------------------------------

void CitySceneAnimation ()
{
    camera.SetFollowActor (GetDummyActor ());
    GetDummyActor ().SetPosition (GetFlagPoint ("INTRO_CAMERA_START").Pos);

    SetOverlayText ("-- Chapter I --\nNo ordinary day", 4000.f, Plain, 200.f, Center);    

    Timeline@ timeline = CreateTimeline ();

    timeline
    .Once (GetAnimTime ('CityMainScene_AnimTime'), function (id)
    {
        CreateCameraToFlagPointTween ("INTRO_CAMERA_END", 'CityMainScene_AnimTime', function (id)
        {
            CityFactorySceneAnimation ();
        });
    });
}

//--------------------------------------------------------------------------------------------------

void CityFactorySceneAnimation ()
{
    SetActiveScene ("2_city/2_city_factory_district.scn", true, function () 
    {
        GetDummyActor ().SetPosition (GetFlagPoint ("INTRO_CAMERA_START").Pos);
        camera.SetFollowActor (GetDummyActor ());
        
        Timeline@ timeline = CreateTimeline ();

        timeline
        .Once (GetAnimTime ('CityFactoryScene_AnimTime1'), function (id)
        {
            CreateCameraToFlagPointTween ("INTRO_CAMERA_A", 'CityFactoryScene_AnimTime1', null);
        })
        .Once (GetAnimTime ('CityFactoryScene_AnimTime2'), function (id)
        {
            CreateCameraToFlagPointTween ("INTRO_CAMERA_END", 'CityFactoryScene_AnimTime2', function (id)
            {
                FactoryMainSceneAnimation ();
            });
        });           
    });
}

//--------------------------------------------------------------------------------------------------

void FactoryMainSceneAnimation ()
{
    SetActiveScene ("1_factory/1_factory_main.scn", true, function () 
    {
        GetDummyActor ().SetPosition (GetFlagPoint ("INTRO_CAMERA_START").Pos);
        camera.SetFollowActor (GetDummyActor ());
        
        Timeline@ timeline = CreateTimeline ();

        timeline
        .Once (GetAnimTime ('FactoryMainScene_Anim1'), function (id)
        {
            CreateCameraToFlagPointTween ("INTRO_CAMERA_A", 'FactoryMainScene_Anim1', null);
        })
        .Once (GetAnimTime ('FactoryMainScene_Anim2'), function (id)
        {
            CreateCameraToFlagPointTween ("INTRO_CAMERA_END", 'FactoryMainScene_Anim2', function (id)
            {
                camera.SetFollowActor (player);
                player.SetPreventInput (false);
                player.SetPosition (GetDummyActor ().GetPosition ());
                player.Show ();
            });
        });          
    });
}

//--------------------------------------------------------------------------------------------------

void Update (float deltaTime)
{
}

//--------------------------------------------------------------------------------------------------